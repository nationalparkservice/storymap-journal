<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		
		<meta name="fragment" content="!">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
		
		<link type="image/ico" rel="shortcut icon" href="resources/tpl/viewer/icons/favicon.ico">
		<link type="image/ico" rel="icon"  href="resources/tpl/viewer/icons/favicon.ico">
		
		<!-- 
			To correctly reference your Map Journal in search engine:
			 - create and fill out extensively an ArcGIS Online item that link to your final application
			 - edit the following four tags as well as the title tag above on line 4
		-->
		<meta name="description" content="This story map was created with the National Park Service Story Map Journal template.">
		
		<!-- Facebook sharing -->
		<meta property="og:type" content="article"/>
		<meta property="og:title" content="NPS Story Map Journal"/>
		<meta property="og:description" content="This story map was created with the National Park Service Story Map Journal template."/>
		<meta property="og:image" content="http://www.arcgis.com/apps/MapJournal/resources/common/icons/esri-globe.png"/>
		
		<!-- 
			This application is released under the Apache License V2.0 by Esri http://www.esri.com/
			Checkout the project repository on GitHub to access source code, latest revision, developer documentation, FAQ and tips
			https://github.com/Esri/map-journal-storytelling-template-js
		-->
		
		<script type="text/javascript">
			//-------------------------------------------------------------------------------------------
			//     Application configuration (ignored on ArcGIS Online, Portal and during development)
			//-------------------------------------------------------------------------------------------
			var configOptions = {
				// Enter an application ID created through the Map Journal builder 
				appid: "",
				// Optionally to secure Journal's access, use an OAuth application ID (example: 6gyOg377fLUhUk6f)
				// User will need to sign-in to access the viewer even if your application is public
				oAuthAppId: "",
				// Optionally, to use the appid URL parameter, configure authorizedOwners to reference
				//    members whose stories can be viewed by this storytelling app.
				// To authorize stories owned by...
				//    specific members: use ["member"] or ["member1", "member2", ...]
				//    any ArcGIS member: use ["*"]
				//    any member of one or more organizations: use ["[orgID]"] or ["[orgID1]", "[orgID2]", ...] (Note the use of brackets in this case, e.g., ["[nzS0F0zdNLvs7nc8]"])
				//        You can get your orgID by going to My Organization and clicking Find...The most viewed items in the organization.
				//        Your orgID will be shown in the search box.
				authorizedOwners: ["*"]
			};
			// Optionally sharing and proxy URLs can be configured in app/config.js. This is only required  
			//  when the webmap is not hosted on ArcGIS Online or a Portal for ArcGIS instance and the application isn't deployed as /home/MapJournal/ or /apps/MapJournal/. 
			// Optionally Bing Maps key, Geometry and Geocode service's URLs can be configured in app/config.js. This is only required
			//  if the Organization or Portal for ArcGIS instance default configuration has to be overwritten.
		</script>
		
		<!--
		
			Edit below at your own risk
		
		-->
		
		<script type="text/javascript">
			var app = {
				version: '1.7.1',
				pathJSAPI: '//js.arcgis.com/3.16/'
			};
		</script>
	</head>
	<body class="claro">
		<style>
			/* CUSTOM CSS RULES */
		</style>
		
		<!-- Builder top panel is injected here -->
		<div id="builderPanel" class="hide mainViewAboveMap"></div>
		
		<!-- Content -->
		<div id="contentPanel" class="mobileView">
			<table class="containerPanelInner">
				<tr>
					<!-- Text panel of the Side Panel layout -->
					<td id="sidePanel">
						<div id="sidePanelInner" class="mainViewSideMap sidePanel sectionPanel">
							<div class="navDots vertical">
								<!-- navigation dots -->
							</div>
							<div class="header" aria-hidden="true">
								<div class="linkSocialContainer">
									<span class="linkContainer"></span>
									<span class="shareBtns">
										<i class="shareIcon blackHover share_facebook icon-facebook-squared"></i>
										<i class="shareIcon blackHover share_twitter icon-twitter"></i>
										<button type="button" class="shareIcon share_bitly icon-link btn-naked" data-toggle="modal" data-target="#shareDialog"></button>
										<button type="button" class="switchBuilder btn btn-xs btn-primary"></button>
									</span>
								</div>
								<table class="logoContainer">
									<tr>
										<td class="logoWrapper">
											<a class="logoLink" target="_blank">
												<img class="logoImg"/>
											</a>
										</td>
									</tr>
								</table>
							</div>
							<div class="appTitle" aria-hidden="true"></div>
							<span class="error-status">
								<button class="btn btn-xs btn-warning check-story"></button>
								<button class="btn btn-xs btn-warning share-story"></button>
							</span>
							<div class="separator"></div>
							<div class="sectionsWrapper">
								<div class="panelEditBtn">
									<div class="panelEditBtnInner"></div>
								</div>
								<div class="sections">
									<!-- sections injected here -->
								</div>
							</div>
							<div class="builder builder-content-panel">
								<div class="builder-content-panel-group builder-add">
									<div class="builder-btn"></div>
									<div class="builder-lbl"></div>
								</div>
								<div class="builder-content-panel-group builder-organize">
									<div class="builder-btn"></div>
									<div class="builder-lbl"></div>
								</div>
							</div>
							<!-- <div class="resizer"></div> -->
							<div class="scroll">
								<div class="scrollInner" data-toggle="tooltip"></div>
							</div>
							<div class="builder-mask"></div>
							<div class="firstAddExplain"></div>
						</div>
					</td>
					<!-- Map -->
					<td id="mainStagePanel">
						<div id="mainStagePanelInner">
							<div class="medias">
								<!-- Maps and media injected here -->
							</div>
							<div id="mainStageLoadingIndicator" class="loadingIndicator">
								<img src="resources/tpl/viewer/icons/loading-light.gif" />
							</div>
							<!-- Back button -->
							<div class="mediaBackContainer">
								<div class="backButton">
									<div class="backArrow"></div>
									<span class="backLbl"></span>
								</div>
							</div>
							<!-- Builder -->
							<div id="builderQuotes" class="centerAlignOnFloat"></div>
							<div id="builderLanding" class="centerAlignOnFloat"></div>
							<div id="builderHelp" class="centerAlignOnFloat"></div>
							<div class="firstAddExplain"></div>
							<!-- Autoplay -->
							<div id="autoplay" class="autoplay"></div>
						</div>
					</td>
				</tr>
			</table>
		</div>
		<!-- /Content -->
		
		<div id="floatingPanel" class="floatingPanel sectionPanel">
			<div class="backdrop"></div>
			<div class="header" aria-hidden="true">
				<div class="linkSocialContainer">
					<span class="linkContainer"></span>
					<span class="shareBtns">
						<i class="shareIcon blackHover share_facebook icon-facebook-squared" title="Share on Facebook"></i>
						<i class="shareIcon blackHover share_twitter icon-twitter" title="Share on Twitter"></i>
						<i class="shareIcon blackHover share_bitly icon-link" title="Share a short link"></i>
						<button type="button" class="switchBuilder btn btn-xs btn-primary"></button>
					</span>
				</div>
				<table class="logoContainer">
					<tr>
						<td class="logoWrapper">
							<a class="logoLink" target="_blank">
								<img class="logoImg"/>
							</a>
						</td>
					</tr>
				</table>
			</div>
			<div class="appTitle" aria-hidden="true"></div>
			<span class="error-status">
				<button class="btn btn-xs btn-warning check-story"></button>
				<button class="btn btn-xs btn-warning share-story"></button>
			</span>
			<div class="separator"></div>
			<div class="panelEditBtn">
				<div class="panelEditBtnInner"></div>
			</div>
			<div class="sections">
				<div class="swiper-container">
					<div class="swiper-wrapper">
						<!-- sections injected here -->
					</div>
				</div>
			</div>
			<div class="builder builder-content-panel">
				<div class="builder-content-panel-group builder-add">
					<div class="builder-btn"></div>
					<div class="builder-lbl"></div>
				</div>
				<div class="builder-content-panel-group builder-organize">
					<div class="builder-btn"></div>
					<div class="builder-lbl"></div>
				</div>
			</div>
			<div class="navDots vertical">
				<!-- navigation dots -->
			</div>
			<div class="scroll">
				<div class="scrollInner" data-toggle="tooltip"></div>
			</div>
			<div class="builder-mask"></div>
			<div class="firstAddExplain"></div>
		</div>
		
		<!-- Mobile -->
		<div id="mobileView" class="floatingSwiper">
			<div class="swiper-container">
				<div class="backdrop"></div>
				<div class="embed-btn-container embed-btn-left">
					<div class="embed-btn"></div>
				</div>
				<div class="swiper-wrapper">
					<!-- sections injected here -->
				</div>
				<div class="embed-btn-container embed-btn-right">
					<div class="embed-btn"></div>
				</div>
			</div>
			<div class="header">
				<div class="backdrop"></div>
				<div class="linkSocialContainer">
					<span class="linkContainer"></span>
					<span class="shareBtns">
						<i class="shareIcon share_facebook icon-facebook-squared"></i>
						<i class="shareIcon share_twitter icon-twitter"></i>
						<button type="button" class="shareIcon share_bitly icon-link btn-naked" data-toggle="modal" data-target="#shareDialog"></button>
					</span>
				</div>
			</div>
		</div>
		
		<!-- Loading -->
		<style>
			#loadingOverlay {
				position: absolute; 
				top: 0; 
				left: 0; 
				z-index: 1100; 
				width: 100%; 
				height: 100%; 
				overflow: hidden; 
				background-color: #E5E5E5; 
				-webkit-box-shadow: inset 0px 0px 82px 19px rgba(0,0,0,0.3); 
				-moz-box-shadow: inset 0px 0px 82px 19px rgba(0,0,0,0.3); 
				box-shadow: inset 0px 0px 82px 19px rgba(0,0,0,0.3);
			}
			
			@keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
			@-moz-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
			@-webkit-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
			@-ms-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
			@-o-keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
			
			@keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
			@-moz-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
			@-webkit-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
			@-ms-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
			@-o-keyframes fadeout { from { opacity: 1; } to { opacity: 0; } }
			
			#loadingOverlay.fadeOut {
				-webkit-animation: fadeout 1.1s;
				-moz-animation: fadeout 1.1s;
				-ms-animation: fadeout 1.1s;
				-o-animation: fadeout 1.1s;
				animation: fadeout 1.1s;
				-webkit-animation-fill-mode:forwards;
				-moz-animation-fill-mode:forwards;
				animation-fill-mode:forwards;
			}
			
			#loadingIndicator {
				position: fixed;
				top: 50%;
				left: 50%;
				z-index: 1101;
			}
			
			.loadingIndicator {
				margin-left: -17px;
				margin-top: -20px;
			}
		</style>
		
		<div id="loadingOverlay"></div>
		<div id="loadingIndicator" class="loadingIndicator">
			<img src="resources/tpl/viewer/icons/loading-light.gif" />
		</div>
		<div id="loadingMessage"></div>
		
		<!-- Share dialog -->
		<div class="modal fade shareDialog" id="shareDialog" role="dialog" data-backdrop="static" aria-labelledby="shareDialogTitle"></div>
		
		<!-- Builder views are injected here -->
		<div id="builder-views"></div>
		
		<!-- Fatal error box -->
		<div id="fatalError">
			<table border="0">
				<tr>
					<td width="70px" align="center" id="fatalError-icon"></td>
					<td id="fatalError-msg">
						<b class="error-title"></b>
						<p class="error-msg"></p>
					</td>
				</tr>
			</table>
		</div>
		
		<script type="text/javascript" src="app/main-config.js"></script>
		<script type="text/javascript">
			require(["dojo/topic"], function(topic) {
				/*
				 * Custom Javascript to be executed while the application is initializing goes here
				 */
				
				function addKeyNavigationToNavigationControls() {
					var swipperSelectors = $('.navDots').find('.navDotsNav, .dot, .navGroup');
					addButtonFeaturesToButtonLikeElements(swipperSelectors);
					//hide tooltips when clicking on navigation control
					//tooltips get shown when control gets focus - good for keyboard users, but not for mouse users
					swipperSelectors.on('click', function(e) {
						$(e.target).tooltip('hide');
						setTimeout(function() {$('.section.active .title').focus()},10);
					});
					//Make the section title focusable, but only programatically
					// do not show the focus ring on this non-interactive elements
					$('.section .title').attr('tabindex', '-1').css('outline', 'none');

					addArrowKeysToNavControl();
				}

				function addArrowKeysToNavControl() {
					var $container = $('.navDotsInner');
					$container.on('keydown', function (e) {
						if (e.keyCode !== 38 && e.keyCode !== 40) {
							return;
						} //Up and down arrow keys
						var delta = (e.keyCode === 38) ? -1 : 1;
						var $focusableElements = $container.find('[tabindex]').not('.disabled');
						var currentIndex = $focusableElements.index(document.activeElement);
						if (currentIndex === -1) {
							return;
						}
						var newIndex = currentIndex + delta;
						if (newIndex < 0) {
							newIndex = 0;
						}
						if ($focusableElements.length <= newIndex) {
							newIndex = $focusableElements.length - 1;
						}
						$focusableElements.eq(newIndex).focus();
						return false;
					});
				}

				function escapeKeyDefaultsToNavigationControl() {
					$('body').on('keydown', function (e) {
						if (e.keyCode === 27) {  //escape
							$('div.dot.active').focus();
							//return false;  // The key handler for colorbox will need to see this as well.
						}
					});
				}

				function addButtonFeaturesToButtonLikeElements($selection)
				{
					$selection
						.attr("tabindex", "0")
						.attr("role", "button")
						.on('keydown', function (e) {
							if (e.keyCode === 32 || e.keyCode === 13) {
								$(e.target).click();
								return false;
							}
						})
						.each(function() {
							var title = $(this).attr('title');
							if (title) {$(this).attr('aria-label', title)}
						});
				}

				function addRefocusEventsToAvoidLostFocus() {
					//Scroll before first
					//var controlElement = $('div.navDotsUp')
					$('div.navDotsUp').on('blur', function (e) {
						if ($(e.target).hasClass('disabled')) {
							$('div.dots :first-child').focus();
						}
					});
					//Scroll after last
					//controlElement = $('div.navDotsDown')
					$('div.navDotsDown').on('blur', function (e) {
						if ($(e.target).hasClass('disabled')) {
							$('div.dots :last-child').focus();
						}
					});
				}

				function makeHeaderElementsFirstInTabOrder()
				{
					$('.header').find('a, button, [tabindex]').attr('tabindex', '1');
					//TODO:  If image in .header a.logoLink has display:none, link still gets focus, but it is off screen
					//Not a high priority, because we will always show the image
				}

				function addSkipMainStageAtSectionBottom() {
					var skippy = $('<a id="skippy" class="sr-only sr-only-focusable" href="#"><div class="container"><span class="skiplink-text">Skip Main Stage</span></div></a>');
					skippy.click(function() {
						$('.section.active + .section').find('.title').focus().get(0).scrollIntoView();
					});
					var sections = $('.section > .social');
					var sectionCount = sections.length;
					sections.filter(function(index) {
						var isNotLastSection = index < sectionCount - 1;
						var isNotImage = app.data.getStoryByIndex(index).media.type != 'image';
						return isNotImage && isNotLastSection;
					}).after(skippy);
				}

				}

				// The application is ready
				topic.subscribe("tpl-ready", function(){
					/*
					 * Custom Javascript to be executed when the application is ready goes here
					 */

					addKeyNavigationToNavigationControls();
					topic.subscribe("story-navigation-control-update", addKeyNavigationToNavigationControls);
					escapeKeyDefaultsToNavigationControl();

					// The 'scroll to see more' control $('.scrollInner') does not need key focus, just go straight to Nav controls

					// Add key navigation to social links
					addButtonFeaturesToButtonLikeElements($('.share_facebook, .share_twitter'));  //.share_bitly already a button

					// Add key navigation to main stage actions (these anchor elements have no href)
					addButtonFeaturesToButtonLikeElements($('a[data-storymaps]'));

					// Add key control to image 'view-fullsize' control
					var viewImageFullsizeControl = $('.image-wrapper .btn-fullscreen');
					addButtonFeaturesToButtonLikeElements(viewImageFullsizeControl);

					// Add key control to all mobile controls (needed for embed mode)
					addButtonFeaturesToButtonLikeElements($('#mobileView').find('p.help-embed, div.embed-btn, span.embed-btn2'));

					addRefocusEventsToAvoidLostFocus();

					makeHeaderElementsFirstInTabOrder();

					addSkipMainStageAtSectionBottom();


				});
			});
		</script>
	</body>
</html>